<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Installation | Data Network Dashboards</title>
  <meta name="description" content="This is the manual for setting up a clean installation of the dashboards used in the EHDEN project." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Installation | Data Network Dashboards" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the manual for setting up a clean installation of the dashboards used in the EHDEN project." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Installation | Data Network Dashboards" />
  
  <meta name="twitter:description" content="This is the manual for setting up a clean installation of the dashboards used in the EHDEN project." />
  

<meta name="author" content="This document is currently under construction" />


<meta name="date" content="2020-10-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="general.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Network Dashboards</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#considerations"><i class="fa fa-check"></i>Considerations</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledges"><i class="fa fa-check"></i>Acknowledges</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#data-network-dashboard"><i class="fa fa-check"></i><b>1.1</b> Data Network Dashboard</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="installation.html"><a href="installation.html#first-steps"><i class="fa fa-check"></i><b>2.1</b> First Steps</a></li>
<li class="chapter" data-level="2.2" data-path="installation.html"><a href="installation.html#dashboard-viewer-setup"><i class="fa fa-check"></i><b>2.2</b> Dashboard Viewer setup</a></li>
<li class="chapter" data-level="2.3" data-path="installation.html"><a href="installation.html#insert-concepts"><i class="fa fa-check"></i><b>2.3</b> Insert Concepts</a></li>
<li class="chapter" data-level="2.4" data-path="installation.html"><a href="installation.html#superset-setup"><i class="fa fa-check"></i><b>2.4</b> Superset setup</a></li>
<li class="chapter" data-level="2.5" data-path="installation.html"><a href="installation.html#dummy-data"><i class="fa fa-check"></i><b>2.5</b> Dummy data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="general.html"><a href="general.html"><i class="fa fa-check"></i><b>3</b> General</a>
<ul>
<li class="chapter" data-level="3.1" data-path="general.html"><a href="general.html#database-type-and-country-filter"><i class="fa fa-check"></i><b>3.1</b> Database Type and Country Filter</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="general.html"><a href="general.html#sql-query"><i class="fa fa-check"></i><b>3.1.1</b> SQL query</a></li>
<li class="chapter" data-level="3.1.2" data-path="general.html"><a href="general.html#chart-settings"><i class="fa fa-check"></i><b>3.1.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="general.html"><a href="general.html#total-number-of-patients"><i class="fa fa-check"></i><b>3.2</b> Total Number of Patients</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="general.html"><a href="general.html#sql-query-1"><i class="fa fa-check"></i><b>3.2.1</b> SQL query</a></li>
<li class="chapter" data-level="3.2.2" data-path="general.html"><a href="general.html#chart-settings-1"><i class="fa fa-check"></i><b>3.2.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="general.html"><a href="general.html#network-growth-by-date"><i class="fa fa-check"></i><b>3.3</b> Network Growth by Date</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="general.html"><a href="general.html#sql-query-2"><i class="fa fa-check"></i><b>3.3.1</b> SQL query</a></li>
<li class="chapter" data-level="3.3.2" data-path="general.html"><a href="general.html#chart-settings-2"><i class="fa fa-check"></i><b>3.3.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="general.html"><a href="general.html#patients-per-country"><i class="fa fa-check"></i><b>3.4</b> Patients per Country</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="general.html"><a href="general.html#sql-query-3"><i class="fa fa-check"></i><b>3.4.1</b> SQL query</a></li>
<li class="chapter" data-level="3.4.2" data-path="general.html"><a href="general.html#chart-settings-3"><i class="fa fa-check"></i><b>3.4.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="general.html"><a href="general.html#database-types-per-country"><i class="fa fa-check"></i><b>3.5</b> Database Types per Country</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="general.html"><a href="general.html#sql-query-4"><i class="fa fa-check"></i><b>3.5.1</b> SQL query</a></li>
<li class="chapter" data-level="3.5.2" data-path="general.html"><a href="general.html#chart-settings-4"><i class="fa fa-check"></i><b>3.5.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="general.html"><a href="general.html#world-map"><i class="fa fa-check"></i><b>3.6</b> World Map</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="general.html"><a href="general.html#sql-query-5"><i class="fa fa-check"></i><b>3.6.1</b> SQL query</a></li>
<li class="chapter" data-level="3.6.2" data-path="general.html"><a href="general.html#chart-settings-5"><i class="fa fa-check"></i><b>3.6.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="general.html"><a href="general.html#meta-data"><i class="fa fa-check"></i><b>3.7</b> Meta Data</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="general.html"><a href="general.html#sql-query-6"><i class="fa fa-check"></i><b>3.7.1</b> SQL query</a></li>
<li class="chapter" data-level="3.7.2" data-path="general.html"><a href="general.html#chart-settings-6"><i class="fa fa-check"></i><b>3.7.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="general.html"><a href="general.html#css"><i class="fa fa-check"></i><b>3.8</b> CSS</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="person.html"><a href="person.html"><i class="fa fa-check"></i><b>4</b> Person</a>
<ul>
<li class="chapter" data-level="4.1" data-path="person.html"><a href="person.html#person---patients-by-age"><i class="fa fa-check"></i><b>4.1</b> Person - Patients by age</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="person.html"><a href="person.html#sql-query-7"><i class="fa fa-check"></i><b>4.1.1</b> SQL query</a></li>
<li class="chapter" data-level="4.1.2" data-path="person.html"><a href="person.html#chart-settings-7"><i class="fa fa-check"></i><b>4.1.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="person.html"><a href="person.html#person---births-by-year"><i class="fa fa-check"></i><b>4.2</b> Person - Births by Year</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="person.html"><a href="person.html#sql-query-8"><i class="fa fa-check"></i><b>4.2.1</b> SQL query</a></li>
<li class="chapter" data-level="4.2.2" data-path="person.html"><a href="person.html#chart-settings-8"><i class="fa fa-check"></i><b>4.2.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="person.html"><a href="person.html#person---gender-distribution"><i class="fa fa-check"></i><b>4.3</b> Person - Gender Distribution</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="person.html"><a href="person.html#sql-query-9"><i class="fa fa-check"></i><b>4.3.1</b> SQL query</a></li>
<li class="chapter" data-level="4.3.2" data-path="person.html"><a href="person.html#chart-settings-9"><i class="fa fa-check"></i><b>4.3.2</b> Chart settings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="population-characteristics.html"><a href="population-characteristics.html"><i class="fa fa-check"></i><b>5</b> Population Characteristics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="population-characteristics.html"><a href="population-characteristics.html#population-characteristics---patients-in-observation-period-per-month"><i class="fa fa-check"></i><b>5.1</b> Population characteristics - Patients in Observation Period per Month</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="population-characteristics.html"><a href="population-characteristics.html#sql-query-10"><i class="fa fa-check"></i><b>5.1.1</b> SQL query</a></li>
<li class="chapter" data-level="5.1.2" data-path="population-characteristics.html"><a href="population-characteristics.html#chart-settings-10"><i class="fa fa-check"></i><b>5.1.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="population-characteristics.html"><a href="population-characteristics.html#population-characteristics---observation-period-end-dates"><i class="fa fa-check"></i><b>5.2</b> Population characteristics - Observation Period End Dates</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="population-characteristics.html"><a href="population-characteristics.html#sql-query-11"><i class="fa fa-check"></i><b>5.2.1</b> SQL query</a></li>
<li class="chapter" data-level="5.2.2" data-path="population-characteristics.html"><a href="population-characteristics.html#chart-settings-11"><i class="fa fa-check"></i><b>5.2.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="population-characteristics.html"><a href="population-characteristics.html#population-characteristics---observation-period-start-dates"><i class="fa fa-check"></i><b>5.3</b> Population characteristics - Observation Period Start Dates</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="population-characteristics.html"><a href="population-characteristics.html#sql-query-12"><i class="fa fa-check"></i><b>5.3.1</b> SQL query</a></li>
<li class="chapter" data-level="5.3.2" data-path="population-characteristics.html"><a href="population-characteristics.html#chart-settings-12"><i class="fa fa-check"></i><b>5.3.2</b> Chart settings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visit.html"><a href="visit.html"><i class="fa fa-check"></i><b>6</b> Visit</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visit.html"><a href="visit.html#visit---types"><i class="fa fa-check"></i><b>6.1</b> Visit - Types</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="visit.html"><a href="visit.html#sql-query-13"><i class="fa fa-check"></i><b>6.1.1</b> SQL query</a></li>
<li class="chapter" data-level="6.1.2" data-path="visit.html"><a href="visit.html#chart-settings-13"><i class="fa fa-check"></i><b>6.1.2</b> Chart settings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="death.html"><a href="death.html"><i class="fa fa-check"></i><b>7</b> Death</a>
<ul>
<li class="chapter" data-level="7.1" data-path="death.html"><a href="death.html#death---by-month-per-thousand-people"><i class="fa fa-check"></i><b>7.1</b> Death - By Month per Thousand People</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="death.html"><a href="death.html#sql-query-14"><i class="fa fa-check"></i><b>7.1.1</b> SQL query</a></li>
<li class="chapter" data-level="7.1.2" data-path="death.html"><a href="death.html#chart-settings-14"><i class="fa fa-check"></i><b>7.1.2</b> Chart settings</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="death.html"><a href="death.html#death---number-of-records"><i class="fa fa-check"></i><b>7.2</b> Death - Number of Records</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="death.html"><a href="death.html#sql-query-15"><i class="fa fa-check"></i><b>7.2.1</b> SQL query</a></li>
<li class="chapter" data-level="7.2.2" data-path="death.html"><a href="death.html#chart-settings-15"><i class="fa fa-check"></i><b>7.2.2</b> Chart settings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="concepts.html"><a href="concepts.html"><i class="fa fa-check"></i><b>8</b> Concepts</a>
<ul>
<li class="chapter" data-level="8.1" data-path="concepts.html"><a href="concepts.html#concepts-general-tab"><i class="fa fa-check"></i><b>8.1</b> Concepts General Tab</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="concepts.html"><a href="concepts.html#sql-query-16"><i class="fa fa-check"></i><b>8.1.1</b> SQL query</a></li>
<li class="chapter" data-level="8.1.2" data-path="concepts.html"><a href="concepts.html#charts"><i class="fa fa-check"></i><b>8.1.2</b> Charts</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="concepts.html"><a href="concepts.html#concepts-domains-tab"><i class="fa fa-check"></i><b>8.2</b> Concepts Domains Tab</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="concepts.html"><a href="concepts.html#sql-query-17"><i class="fa fa-check"></i><b>8.2.1</b> SQL query</a></li>
<li class="chapter" data-level="8.2.2" data-path="concepts.html"><a href="concepts.html#chart-settings-16"><i class="fa fa-check"></i><b>8.2.2</b> Chart settings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data-domains.html"><a href="data-domains.html"><i class="fa fa-check"></i><b>9</b> Data Domains</a>
<ul>
<li class="chapter" data-level="9.1" data-path="data-domains.html"><a href="data-domains.html#data-domains---number-of-records-per-peson"><i class="fa fa-check"></i><b>9.1</b> Data Domains - Number of Records per Peson</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="data-domains.html"><a href="data-domains.html#sql-query-18"><i class="fa fa-check"></i><b>9.1.1</b> SQL query</a></li>
<li class="chapter" data-level="9.1.2" data-path="data-domains.html"><a href="data-domains.html#chart-settings-17"><i class="fa fa-check"></i><b>9.1.2</b> Chart settings</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Network Dashboards</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="installation" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Installation</h1>
<p>Currently, we use docker to deploy our environment</p>
<div id="first-steps" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> First Steps</h2>
<ol style="list-style-type: decimal">
<li><p>Clone the repository with the command <code>git clone --recurse-submodules https://github.com/EHDEN/NetworkDashboards</code>. If you already cloned the repository without the <code>--recurse-submodules</code> option, run <code>git submodule update --init</code> to fetch the superset submodule.</p></li>
<li><p>Create a <code>.env</code> file on the <code>docker</code> directory, using <code>.env-example</code> as a reference, setting all necessary environment variables (<code>SUPERSET\_MAPBOX\_API\_KEY</code> and <code>DASHBOARD\_VIEWER\_SECRET\_KEY</code>).</p></li>
</ol>
</div>
<div id="dashboard-viewer-setup" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Dashboard Viewer setup</h2>
<ol style="list-style-type: decimal">
<li><p>If you wish to expose the dashboard viewer app through a specific domain(s) you must add it/them to the <code>ALLOWED_HOSTS</code> list on file <code>dashboard_viewer/dashboard_viewer/settings.py</code> and remove the <code>'*'</code> entry.</p></li>
<li><p>Build containers’ images: <code>docker-compose build</code>. This might take several minutes.</p></li>
<li><p>Set up the database and create an admin account for the dashboard viewer app: <code>docker-compose run --rm dashboard ./docker-init.sh</code>.</p></li>
</ol>
</div>
<div id="insert-concepts" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Insert Concepts</h2>
<p>The concepts table is not in the repository due to its dimension, therefore we use directly the Postgres console to insert this table in the installation.</p>
<ol style="list-style-type: decimal">
<li><p>Get your concept csv file from <a href="https://athena.ohdsi.org/">Athena</a></p></li>
<li><p>Copy the file into postgres container</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="installation.html#cb1-1" aria-hidden="true"></a><span class="ex">docker</span> cp concept.csv dashboard_viewer_postgres_1:/tmp/</span></code></pre></div></li>
<li><p>Enter in the postgres container:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="installation.html#cb2-1" aria-hidden="true"></a><span class="ex">docker</span> exec -it dashboard_viewer_postgres_1 bash</span></code></pre></div></li>
<li><p>Enter in the <code>achilles</code> database (value of the variable <code>POSTGRES_ACHILLES_DB</code> on the .env file) with the <code>root</code> user (value of the variable <code>POSTGRES_ROOT_USER</code> on the .env file):</p>
<pre><code>psql achilles root</code></pre></li>
<li><p>Create the <code>concept</code> table</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="installation.html#cb4-1" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> concept (</span>
<span id="cb4-2"><a href="installation.html#cb4-2" aria-hidden="true"></a>  concept_id         <span class="dt">INTEGER</span>        <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-3"><a href="installation.html#cb4-3" aria-hidden="true"></a>  concept_name       <span class="dt">VARCHAR</span>(<span class="dv">255</span>)   <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-4"><a href="installation.html#cb4-4" aria-hidden="true"></a>  domain_id          <span class="dt">VARCHAR</span>(<span class="dv">20</span>)    <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-5"><a href="installation.html#cb4-5" aria-hidden="true"></a>  vocabulary_id      <span class="dt">VARCHAR</span>(<span class="dv">20</span>)    <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-6"><a href="installation.html#cb4-6" aria-hidden="true"></a>  concept_class_id   <span class="dt">VARCHAR</span>(<span class="dv">20</span>)    <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-7"><a href="installation.html#cb4-7" aria-hidden="true"></a>  standard_concept   <span class="dt">VARCHAR</span>(<span class="dv">1</span>)     <span class="kw">NULL</span>,</span>
<span id="cb4-8"><a href="installation.html#cb4-8" aria-hidden="true"></a>  concept_code       <span class="dt">VARCHAR</span>(<span class="dv">50</span>)    <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-9"><a href="installation.html#cb4-9" aria-hidden="true"></a>  valid_start_date   <span class="dt">DATE</span>           <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-10"><a href="installation.html#cb4-10" aria-hidden="true"></a>  valid_end_date     <span class="dt">DATE</span>           <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb4-11"><a href="installation.html#cb4-11" aria-hidden="true"></a>  invalid_reason     <span class="dt">VARCHAR</span>(<span class="dv">1</span>)     <span class="kw">NULL</span></span>
<span id="cb4-12"><a href="installation.html#cb4-12" aria-hidden="true"></a>);</span></code></pre></div></li>
<li><p>Copy the CSV file content to the table (this could take a while)</p>
<p>To get both <code>'</code> (single quotes) and <code>"</code> (double quotes) on the <code>concept_name</code> column we use a workaround by setting the quote character to one that should never be in the text. Here we used <code>\b</code> (backslash).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="installation.html#cb5-1" aria-hidden="true"></a><span class="kw">COPY</span> <span class="kw">public</span>.concept <span class="kw">FROM</span> <span class="st">&#39;/tmp/concept.csv&#39;</span> <span class="kw">WITH</span> CSV <span class="kw">HEADER</span></span>
<span id="cb5-2"><a href="installation.html#cb5-2" aria-hidden="true"></a>  DELIMITER E<span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span> QUOTE E<span class="st">&#39;</span><span class="ch">\b</span><span class="st">&#39;</span>;</span></code></pre></div></li>
<li><p>Create index in table (this could take a while):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="installation.html#cb6-1" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> concept_concept_id_index <span class="kw">ON</span> concept (concept_id);</span>
<span id="cb6-2"><a href="installation.html#cb6-2" aria-hidden="true"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> concept_concept_name_index <span class="kw">ON</span> concept (concept_name);</span></code></pre></div></li>
<li><p>Set the owner of the <code>concept</code> table to the <code>achilles</code> user (value of the variable <code>POSTGRES_ACHILLES_USER</code> on the .env file):</p>
<pre><code>ALTER TABLE concept OWNER TO achiller</code></pre></li>
<li><p>Bring up the containers: <code>docker-compose up -d</code>.</p></li>
<li><p>Run the command <code>docker-compose run --rm dashboard python manage.py generate_materialized_views</code> to create the materialized views on Postgres.</p></li>
</ol>
</div>
<div id="superset-setup" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Superset setup</h2>
<ol style="list-style-type: decimal">
<li><p>Make sure that the container <code>superset-init</code> has finished before continuing. It is creating the necessary tables on the database and creating permissions and roles.</p></li>
<li><p>Execute the script <code>./superset/one_time_run_scripts/superset-init.sh</code>. This will create an admin account and associate the <code>achilles</code> database to Superset. <strong>Attention:</strong> You must be in the docker directory to execute this script.</p></li>
<li><p>We have already built some dashboards so if you want to import them run the script <code>./superset/one_time_run_scripts/load_dashboards.sh</code>. <strong>Attention:</strong> You must be in the docker directory to execute this script.</p></li>
<li><p>If you used the default ports:</p>
<ul>
<li>Go to <code>http://localhost</code> to access the dashboard viewer app.</li>
<li>Go to <code>http://localhost:8088</code> to access superset.</li>
</ul></li>
<li><p>On release 0.37 of Superset, there is a bug related to the public role and because of that, we had to set <code>PUBLIC_ROLE_LIKE_GAMMA = True</code> on Superset settings. This leads the public role with permissions that he shouldn’t have. To solve this, so any anonymous user can view dashboards, you should remove all its permissions and then add the following:</p>
<ul>
<li>can explore JSON on Superset</li>
<li>can dashboard on Superset</li>
<li>all datasource access on all_datasource_access</li>
<li>can csrf token on Superset</li>
<li>can list on CssTemplateAsyncModelView</li>
</ul></li>
</ol>
</div>
<div id="dummy-data" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Dummy data</h2>
<p>On a fresh installation, there are no achilles_results data so Superset’s dashboards will display “No results”. On the root of this repository, you can find the <code>demo</code> directory where we have an ACHILLES results file with synthetic data that you can upload to a data source on the uploader app of the dashboard viewer (localhost/uploader). If you wish to compare multiple data sources, on the <code>demo</code> directory the is also a python script that allows you to generate new ACHILLES results files, where it generates random count values based on the ranges of values for each set of analysis_id and stratums present on a base ACHILLES results file. So, from the one ACHILLES results fill we provided, you can have multiple data sources with different data.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="general.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-installation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["DataNetworkDashboards.pdf", "DataNetworkDashboards.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
